clc
clear

tic
%x1=[-1.2; 1]; % Rosen
x1=[3; -1;0;1]; %Powell
e1=0.01;
e = [6];




%B=eye(2); %%rosen
B=eye(4); %%powell


%I=eye(2); %%rosen
I=eye(4); %%powell

i=1;
while e(i)>e1
    i=i+1
    %fn1 = 100*(x1(2)-x1(1)^2)^2+(1-x1(1))^2; %%Rosen
    
    %G1= [2*x1(1) - 400*x1(1)*(- x1(1)^2 + x1(2)) - 2;...
    %    - 200*x1(1)^2 + 200*x1(2)];
    
    fn1 = (x1(1)+10*x1(2))^2 + 5*(x1(3)-x1(4))^2 +(x1(2)-2*x1(3))^4 + 10*(x1(1)-x1(4))^4; %%powell
    G1= [2*x1(1) + 20*x1(2) - 40*(x1(4) - x1(1))^3;...
        20*x1(1) + 200*x1(2) + 4*(x1(2) - 2*x1(3))^3;...
        10*x1(3) - 10*x1(4) - 8*(x1(2) - 2*x1(3))^3;...
        10*x1(4) - 10*x1(3) + 40*(x1(4) - x1(1))^3];
    
    
    
    s1=-B*G1;
    
    %FL=@(L)100*((x1(2)+L*s1(2))-(x1(1)+L*s1(1))^2)^2+(1-(x1(1)+L*s1(1)))^2; %%rosen
    FL=@(L)((x1(1)+L*s1(1))+10*(x1(2)+L*s1(2)))^2 + 5*((x1(3)+L*s1(3))-(x1(4)+L*s1(4)))^2 +...
        ((x1(2)+L*s1(2))-2*(x1(3)+L*s1(3)))^4 + 10*((x1(1)+L*s1(1))-(x1(4)+L*s1(4)))^4; %%Powell
    L= fminbnd(FL,-1000,1000);
    
    x2 = x1 + L*s1;
    
    %%Rosen
%     fn2 = 100*(x2(2)-x2(1)^2)^2+(1-x2(1))^2; 
%     G2= [2*x2(1) - 400*x2(1)*(- x2(1)^2 + x2(2)) - 2;...
%         - 200*x2(1)^2 + 200*x2(2)]; 

   %%Powell
    fn2 = (x2(1)+10*x2(2))^2 + 5*(x2(3)-x2(4))^2 +(x2(2)-2*x2(3))^4 + 10*(x2(1)-x2(4))^4; %%powell
    G2= [2*x2(1) + 20*x2(2) - 40*(x2(4) - x2(1))^3;...
        20*x2(1) + 200*x2(2) + 4*(x2(2) - 2*x2(3))^3;...
        10*x2(3) - 10*x2(4) - 8*(x2(2) - 2*x2(3))^3;...
        10*x2(4) - 10*x2(3) + 40*(x2(4) - x2(1))^3];
    
    
    y=G2-G1;
    B=B + L*(s1*s1')/(s1'*y)-(B*y)*(B*y)'/(y'*B*y);
    
    
    e(i) = G2'*G2;
    if e(i)<e1
        break
    end
    x1 = x2;
end
f = fn1;
toc



